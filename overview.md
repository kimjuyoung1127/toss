## 프로젝트 DogPose: '앱인토스(Apps-in-Toss)' 미니앱 구축 종합 계획서

**문서 목적:** 본 문서는 '강아지 전용 운동분석프로젝트'의 핵심 기술을 활용하여, '토스 앱인토스' 플랫폼에 미니앱을 성공적으로 출시하기 위한 전체 전략과 단계별 실행 계획을 정의합니다.

---

### 1. 개요 및 핵심 전략

### 1.1. 전략적 전환

기존 프로젝트(`overview.md`)의 목표는 서버 지연 시간을 제거한 실시간 클라이언트 측 AI 분석입니다. 초기 네이티브 앱 개발(12-18개월 소요) 대신, 우리는 **'앱인토스 미니앱'**으로 전략을 수정합니다.

### 1.2. 기대 효과

- **개발 기간 단축:** 12-18개월에서 **2-3개월**로 획기적으로 단축합니다.
- **즉각적인 시장 접근:** 출시 즉시 **토스의 3,000만 사용자**에게 도달할 수 있습니다.
- **핵심 자산 재활용:** 기존에 구축한 **React + ONNX Runtime Web 스택을 100% 재활용**합니다.

### 1.3. 듀얼 프로젝트 전략

우리는 두 개의 프로젝트를 병렬로 관리하는 **'듀얼 프로젝트'** 전략을 채택합니다.

1. **`dogpose` (기존 프로젝트 - 엔진 룸):**
    - **역할:** 말씀하신 대로 "추출용" 핵심 엔진 역할을 합니다.
    - **관리 대상:** AI 모델(`yolov11_pose_dog.onnx`), 생체역학 계산 로직, 캔버스 렌더링 함수 등 핵심 기술 R&D를 담당합니다.
2. **`dogpose-apps-in-toss` (신규 프로젝트 - 래퍼):**
    - **역할:** 토스 앱 내에서 실행될 사용자 대면 애플리케이션입니다.
    - **관리 대상:** `dogpose`에서 복제한 `frontend` 코드를 기반으로, 토스 SDK 연동, 토스 디자인 시스템(TDS) 적용, 토스 로그인/권한 처리 등 '앱인토스' 플랫폼에 특화된 최적화를 수행합니다.

### 2. 전체 시스템 아키텍처

아키텍처는 기존 `overview.md`의 하이브리드 모델을 그대로 따르며, 클라이언트만 변경됩니다.

- **클라이언트 (Client):** 신규 `dogpose-apps-in-toss` React 프로젝트. 토스 앱 내의 WebView에서 실행됩니다.
- **AI 추론 (Inference):** 클라이언트(WebView)에서 **ONNX Runtime Web**을 통해 100% 로컬로 수행됩니다.
- **백엔드 (Backend):** **기존 FastAPI 프로젝트를 100% 재사용**합니다. 사용자 인증(토스 유저 키 기반), 데이터 집계 등 비실시간 작업을 처리합니다.
- **데이터베이스 (Database):** **기존 TimescaleDB를 100% 재사용**합니다. 모든 생체역학 시계열 데이터를 저장합니다.

### 3. 핵심 검증 사항 (Phase 0 최우선 과제)

본 계획의 성패를 가르는 가장 치명적인 기술 검증 사항이 존재합니다.

- **문제:** 토스 SDK의 `openCamera` API가 실시간 비디오 스트림(`MediaStream`)을 반환하는지, 아니면 촬영 완료된 파일의 URI만 반환하는지 불명확합니다.
- **영향:** 만약 스트림 접근이 불가능하면, `overview.md`의 핵심 가치인 **'실시간 분석'이 불가능**해집니다.
- **실행 계획:**
    1. **Plan A 테스트 (1순위):** 앱인토스 샌드박스 환경에서 표준 웹 API인 `navigator.mediaDevices.getUserMedia()` 호출을 시도합니다.
    2. **Plan B (대안):** `getUserMedia`가 차단되었다면, 서비스 모델을 **'동영상 업로드 후 분석'** 방식으로 즉시 전환합니다.

### 4. 단계별 실행 로드맵 (2-3개월)

### Phase 0: 검증 및 프로젝트 준비 (2~3주)

1. **[최우선]** 3절의 **'핵심 검증 사항(Plan A/B)'을 테스트**하여 서비스의 실시간성 여부를 확정합니다.
2. `dogpose` 프로젝트의 `frontend` 폴더를 `dogpose-apps-in-toss`라는 새 프로젝트로 복제합니다.
3. 토스 앱인토스 콘솔 가입 및 '펫핏 AI'(가칭) 신규 앱을 등록합니다.
4. 기존 `backend/main.py`의 CORS 허용 목록에 앱인토스 도메인(`.tossmini.com`)을 추가합니다.
5. 백엔드(FastAPI)를 **HTTPS** 환경으로 배포합니다. (앱인토스 라이브 환경 필수 조건)

### Phase 1: SDK 통합 및 MVP 기능 구현 (1~2주)

1. 신규 프로젝트에 `@apps-in-toss/web-framework` SDK를 설치합니다.
2. `granite.config.ts` 파일을 생성하고 '카메라', '사진첩' 권한을 명시합니다.
3. Phase 0의 테스트 결과(Plan A 또는 B)에 따라 카메라 연동 로직을 구현합니다.
4. 백엔드 API 호출 시, 헤더에 토스 유저 식별 키(`x-toss-user-key`)를 포함하도록 수정합니다.
5. `npm run build` 후 빌드 파일을 콘솔에 업로드하고, QR 코드를 통해 샌드박스 환경에서 MVP 기능을 테스트합니다.

### Phase 2: 성능 최적화 및 토스 UX 적용 (3~4주)

1. **AI 모델 최적화:** `yolov11_pose_dog.onnx` 모델을 **INT8 양자화(Quantization)**하여 모델 파일 크기를 100MB 제한 미만으로 맞추고, 추론 속도를 향상시킵니다.
2. **성능 최적화:** ONNX Runtime Web의 `webgl` 백엔드를 활성화하고, 모델 입력 해상도를 조정(예: 416x416)하여 모바일 웹뷰 성능을 확보합니다.
3. **UI/UX 전면 교체:** 토스 앱빌더와 **토스 디자인 시스템(TDS) 컴포넌트**를 사용하여, 기존 UI를 토스 앱에 완벽하게 통합된 네이티브 경험으로 재설계합니다.
4. (선택 사항) 프리미엄 리포트 기능을 위해 토스페이 결제 API를 연동합니다.

### Phase 3: 출시 준비 및 검수 (2~3주)

1. **법적 고지 구현:** `overview.md` 6.3절의 **면책 조항** (예: "본 서비스는 진단 도구가 아닙니다", "수의사와 상담하세요")을 온보딩 또는 분석 시작 화면에 명확히 고지합니다.
2. **개인정보보호 강조:** "당신의 영상 데이터는 기기를 떠나지 않습니다"라는 프라이버시 문구를 명시하여 사용자 신뢰를 확보합니다.
3. 토스의 4단계(운영, 디자인, 기능, 보안) 검수 가이드라인을 준수하여 앱을 최종 점검합니다.
4. 콘솔에서 '피처'(예: "강아지 건강 분석하기")를 등록하고 최종 검수를 요청합니다.

### 5. 주요 성공 지표 (KPI) (출시 3개월 목표)

본 계획의 성공은 다음 지표로 측정합니다.

- **누적 이용자:** 10,000명
- **일일 활성 유저 (DAU):** 500명
- **유료 전환율 (프리미엄 기능 도입 시):** 3~5%